<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.intranet.ssmcrmserver.dao.mapper.SysPermMapper">

    <resultMap id="SysPermResult" type="com.intranet.ssmcrmserver.dao.model.SysPerm">
        <id     column="perm_id" property="permId" jdbcType="INTEGER"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="terminal_type" property="terminalType" jdbcType="INTEGER"/>
        <result column="perm_type" property="permType" jdbcType="INTEGER"/>
        <result column="order_num" property="orderNum" jdbcType="INTEGER"/>
        <result column="use_status" property="useStatus" jdbcType="INTEGER"/>
        <result column="is_init" property="isInit" jdbcType="INTEGER"/>
        <result column="is_del" property="isDel" jdbcType="INTEGER"/>
        <result column="create_by" property="createBy" jdbcType="INTEGER"/>
        <result column="create_at" property="createAt" jdbcType="BIGINT"/>
        <result column="update_by" property="updateBy" jdbcType="INTEGER"/>
        <result column="update_time" property="updateTime"/>
    </resultMap>

    <sql id="base_column_list">
        perm_id,name,terminal_type,perm_type,use_status,order_num,is_init,is_del,create_by,create_at,update_by,update_time
    </sql>

    <sql id="where_clause">
        <if test="permId != null">
            AND perm_id = #{permId}
        </if>
        <if test="permIdList != null">
            and perm_id in
            <foreach collection="permIdList" item="id" index="index" open="(" separator="," close=")">
                #{id}
            </foreach>
        </if>
        <if test="name != null">
            AND name like "%"#{name}"%"
        </if>
        <if test="terminalType != null">
            AND terminal_type = #{terminalType}
        </if>
        <if test="permType != null">
            AND perm_type = #{permType}
        </if>
        <if test="useStatus != null">
            AND use_status = #{useStatus}
        </if>
        <if test="isInit != null">
            AND is_init = #{isInit}
        </if>
        <!-- 数据范围过滤 -->
        ${params.dataScope}
        order by order_num asc, perm_id desc
    </sql>

    <select id="selectListBySelective" parameterType="com.intranet.ssmcrmserver.dao.model.SysPerm" resultMap="SysPermResult">
        select <include refid="base_column_list"/> from sys_perm
        where is_del = 0
        <include refid="where_clause"></include>
    </select>

    <select id="selectOnUsePermsList" resultMap="SysPermResult">
        select <include refid="base_column_list"/> from sys_perm
        where is_del = 0 and use_status = 1
    </select>

    <select id="selectOnUseListByDeptId" parameterType="java.lang.Integer" resultMap="SysPermResult">
        select <include refid="base_column_list"/> from sys_perm
        where is_del = 0 and use_status = 1 and dept_id = #{deptId}
    </select>

    <select id="selectOneByPermId" parameterType="INTEGER" resultMap="SysPermResult">
        select <include refid="base_column_list"/> from sys_perm
        where perm_id = #{permId}
    </select>

    <select id="checkPermNameUnique" resultMap="SysPermResult">
        select <include refid="base_column_list"></include> from sys_perm
        where name=#{name} and terminal_type = #{terminalType} and is_del = 0
        <if test="permType != null">
            and perm_type = #{permType}
        </if>
         limit 1
    </select>

    <insert id="insertBySelective" parameterType="com.intranet.ssmcrmserver.dao.model.SysPerm" useGeneratedKeys="true" keyProperty="permId">
        insert into sys_perm
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="name != null">
                name,
            </if>
            <if test="terminalType != null">
                terminal_type,
            </if>
            <if test="permType != null">
                perm_type,
            </if>
            <if test="orderNum != null">
                order_num,
            </if>
            <if test="isInit != null">
                is_init,
            </if>
            <if test="useStatus != null">
                use_status,
            </if>
            <if test="createBy != null">
                create_by,
            </if>
            <if test="updateBy != null">
                update_by,
            </if>
            <if test="isDel != null">
                is_del,
            </if>
            <if test="createAt != null">
                create_at
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="name != null">
                #{name},
            </if>
            <if test="terminalType != null">
                #{terminalType},
            </if>
            <if test="permType != null">
                #{permType},
            </if>
            <if test="orderNum != null">
                #{orderNum},
            </if>
            <if test="isInit != null">
                #{isInit},
            </if>
            <if test="useStatus != null">
                #{useStatus},
            </if>
            <if test="createBy != null">
                #{createBy},
            </if>
            <if test="updateBy != null">
                #{updateBy},
            </if>
            <if test="isDel != null">
                #{isDel},
            </if>
            <if test="createAt != null">
                #{createAt}
            </if>
        </trim>
    </insert>

    <update id="updateBySelective" parameterType="com.intranet.ssmcrmserver.dao.model.SysPerm">
        update sys_perm
        <set>
            <if test="name != null">
                name = #{name},
            </if>
            <if test="isInit != null">
                is_init = #{isInit},
            </if>
            <if test="orderNum != null">
                order_num = #{orderNum},
            </if>
            <if test="useStatus != null">
                use_status = #{useStatus},
            </if>
        </set>
        where perm_id = #{permId}
    </update>


    <delete id="deleteByPermId" parameterType="java.lang.Integer">
        update sys_perm set is_del = 1 where perm_id = #{permId}
    </delete>

</mapper>